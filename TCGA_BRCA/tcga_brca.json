{
  "genome": { "name": "hg19" },

  "description": [
    "TCGA-BRCA: CNVs and Mutations",
    "The results shown here are in whole or part based upon data generated by the TCGA Research Network: https://www.cancer.gov/tcga."
  ],

  "resolve": { "scale": { "x": "shared" } },

  "concat": [
    {
      "resolve": {
        "scale": { "color": "independent" }
      },

      "samples": {
        "data": {
          "url": "samples.tsv"
        },

        "attributes": {
          "er_status": {
            "type": "nominal",
            "scale": {
              "domain": ["Negative", "Positive", "Indeterminate"],
              "scheme": "set1"
            }
          },
          "pr_status": {
            "type": "nominal",
            "scale": {
              "domain": ["Negative", "Positive", "Indeterminate"],
              "scheme": "set1"
            }
          },
          "her2_status": {
            "type": "nominal",
            "scale": {
              "domain": ["Negative", "Positive", "Indeterminate", "Equivocal"],
              "scheme": "set1"
            }
          },
          "PFI": {
            "type": "nominal"
          },
          "PFI.time": {
            "scale": {
              "type": "sqrt"
            }
          },
          "breaks": {
            "type": "quantitative",
            "colorScale": {
              "scheme": "lightorange"
            },
            "barScale": {},
            "width": 20
          }
        }
      },

      "spec": {
        "resolve": {
          "scale": { "color": "independent" }
        },

        "layer": [
          {
            "name": "cnv",

            "title": "Copy number variation",
            "data": {
              "url": "segments.tsv"
            },

            "mark": {
              "type": "rect"
            },

            "encoding": {
              "x": {
                "chrom": "Chromosome",
                "pos": "Start",
                "type": "locus",
                "axis": null
              },
              "x2": { "chrom": "Chromosome", "pos": "End" },
              "sample": { "field": "Sample", "type": "nominal" },
              "color": {
                "field": "Segment_Mean",
                "type": "quantitative",
                "scale": {
                  "domain": [-1.5, 0, 1.5],
                  "range": ["#0050f8", "#f6f6f6", "#ff3000"]
                }
              }
            },

            "aggregateSamples": [
              {
                "name": "cnvSummary",
                "height": 50,
                "transform": [],
                "encoding": {
                  "y": {
                    "field": "coverage",
                    "type": "quantitative",
                    "axis": null,
                    "scale": { "domain": [-1, 0, 1] }
                  }
                },
                "layer": [
                  {
                    "name": "amplification",
                    "transform": [
                      { "type": "filter", "expr": "datum.Segment_Mean > 0" },
                      {
                        "type": "coverage",
                        "chrom": "Chromosome",
                        "start": "Start",
                        "end": "End",
                        "weight": "Segment_Mean"
                      },
                      {
                        "type": "formula",
                        "expr": "datum.coverage / sampleCount",
                        "as": "coverage"
                      }
                    ],
                    "mark": {
                      "type": "rect",
                      "minOpacity": 1,
                      "minWidth": 0,
                      "tooltip": null,
                      "dynamicData": true
                    },
                    "encoding": {
                      "color": { "value": "#e45756" }
                    }
                  },
                  {
                    "name": "deletion",
                    "transform": [
                      { "type": "filter", "expr": "datum.Segment_Mean < 0" },
                      {
                        "type": "coverage",
                        "chrom": "Chromosome",
                        "start": "Start",
                        "end": "End",
                        "weight": "Segment_Mean"
                      },
                      {
                        "type": "formula",
                        "expr": "datum.coverage / sampleCount",
                        "as": "coverage"
                      }
                    ],
                    "mark": {
                      "type": "rect",
                      "minOpacity": 1,
                      "minWidth": 0,
                      "tooltip": null,
                      "dynamicData": true
                    },
                    "encoding": {
                      "color": { "value": "#4c78a8" }
                    }
                  }
                ]
              }
            ]
          },
          {
            "name": "mutations",

            "data": {
              "url": "mutations.tsv"
            },

            "transform": [
              {
                "type": "formula",
                "expr": "datum.Chromosome == 'MT' ? 'M' : datum.Chromosome",
                "as": "Chromosome"
              }
            ],

            "mark": {
              "type": "point",
              "stroke": "black",
              "strokeWidth": 1,
              "strokeOpacity": 0.7,
              "fillGradientStrength": 0.3,
              "geometricZoomBound": 2.6
            },

            "encoding": {
              "sample": { "field": "Sample", "type": "nominal" },
              "x": {
                "chrom": "Chromosome",
                "pos": "Start_Position",
                "type": "locus"
              },
              "color": {
                "field": "Variant_Classification",
                "type": "nominal",
                "scale": {
                  "domain": [
                    "Nonsense_Mutation",
                    "Nonstop_Mutation",
                    "Frame_Shift_Ins",
                    "Frame_Shift_Del",
                    "Missense",
                    "Missense_Mutation",
                    "Splice_Site_Del",
                    "Splice_Site_Ins",
                    "Splice_Site_SNP",
                    "In_Frame_Del",
                    "In_Frame_Ins",
                    "Silent"
                  ],
                  "range": [
                    "#e31a1c",
                    "#ff7f00",
                    "#6a3d9a",
                    "#6a3d9a",
                    "#1f78b4",
                    "#1f78b4",
                    "#b2df8a",
                    "#b2df8a",
                    "#b2df8a",
                    "#cab2d6",
                    "#cab2d6",
                    "#33a02c"
                  ]
                }
              },
              "size": { "value": 300 },
              "gradientStrength": {
                "value": 0.3
              },
              "semanticScore": {
                "field": "CADD_PHRED",
                "type": "quantitative"
              }
            }
          }
        ]
      }
    },
    {
      "name": "dummyAxis",
      "height": { "grow": 0 },
      "data": { "values": [] },
      "mark": "rect",
      "padding": { "top": -5 },
      "encoding": {
        "x": {
          "chrom": "chr",
          "pos": "pos",
          "type": "locus",
          "title": null,
          "axis": {
            "domain": false
          }
        }
      }
    }
  ]
}
